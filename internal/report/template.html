<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Repository Health Report - {{.Metadata.Repository}}</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'%3E%3Cpath fill='%237A4A22' d='M160 90C160 60 352 60 352 90L352 130L160 130Z'/%3E%3Crect fill='%235E3618' x='140' y='130' width='232' height='28' rx='14'/%3E%3Cellipse fill='%233B8C8E' cx='138' cy='220' rx='28' ry='42'/%3E%3Cellipse fill='%233B8C8E' cx='374' cy='220' rx='28' ry='42'/%3E%3Cpath fill='%234FA3A5' d='M128 180C128 130 384 130 384 180V360C384 410 128 410 128 360Z'/%3E%3Cellipse fill='%23FFFFFF' cx='220' cy='240' rx='34' ry='38'/%3E%3Cellipse fill='%23FFFFFF' cx='292' cy='240' rx='34' ry='38'/%3E%3Ccircle fill='%231B1B1B' cx='228' cy='252' r='10'/%3E%3Ccircle fill='%231B1B1B' cx='300' cy='252' r='10'/%3E%3Cellipse fill='%232A2A2A' cx='256' cy='286' rx='14' ry='10'/%3E%3Crect fill='%23F2F2F2' x='242' y='304' width='12' height='24' rx='3'/%3E%3Crect fill='%23F2F2F2' x='258' y='304' width='12' height='24' rx='3'/%3E%3Cg transform='translate(330 260)'%3E%3Ccircle fill='%23C9B36D' cx='0' cy='0' r='56'/%3E%3Ccircle fill='%23FFF6D5' cx='0' cy='0' r='42'/%3E%3Crect fill='%236A4020' x='40' y='40' width='90' height='14' rx='7' transform='rotate(35)'/%3E%3C/g%3E%3Cpath fill='%233B8C8E' d='M128 330C180 360 332 360 384 330V360C384 410 128 410 128 360Z' opacity='0.6'/%3E%3C/svg%3E">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/simple-datatables@9/dist/style.min.css">
    <script src="https://cdn.jsdelivr.net/npm/simple-datatables@9"></script>
    <script src="https://cdn.jsdelivr.net/npm/date-fns@4/cdn.min.js"></script>
    <script src="https://unpkg.com/@popperjs/core@2"></script>
    <script src="https://unpkg.com/tippy.js@6"></script>
    <style>
        :root {
            --bg-primary: #0d1117;
            --bg-secondary: #161b22;
            --bg-tertiary: #21262d;
            --text-primary: #e6edf3;
            --text-secondary: #8b949e;
            --border-color: #30363d;
            --accent-green: #3fb950;
            --accent-yellow: #d29922;
            --accent-red: #f85149;
            --accent-blue: #58a6ff;
            --accent-purple: #a371f7;
            --sidebar-width: 220px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans', Helvetica, Arial, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
        }

        /* Sidebar Navigation */
        .sidebar {
            position: fixed;
            top: 0;
            left: 0;
            width: var(--sidebar-width);
            height: 100vh;
            background: var(--bg-secondary);
            border-right: 1px solid var(--border-color);
            padding: 1.5rem 0;
            overflow-y: auto;
            z-index: 100;
        }

        .sidebar-header {
            padding: 0 1rem 1rem;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 1rem;
        }

        .sidebar-header h2 {
            font-size: 1rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .sidebar-score {
            font-size: 2rem;
            font-weight: bold;
            margin-top: 0.25rem;
        }

        .sidebar-score.good { color: var(--accent-green); }
        .sidebar-score.warning { color: var(--accent-yellow); }
        .sidebar-score.danger { color: var(--accent-red); }

        .nav-section {
            padding: 0.5rem 0;
        }

        .nav-section-title {
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-secondary);
            padding: 0.5rem 1rem;
            margin-top: 0.5rem;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 0.85rem;
            transition: all 0.15s;
        }

        .nav-item:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .nav-item.active {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border-left: 2px solid var(--accent-blue);
        }

        .nav-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            flex-shrink: 0;
        }

        .nav-dot.good { background: var(--accent-green); }
        .nav-dot.warning { background: var(--accent-yellow); }
        .nav-dot.danger { background: var(--accent-red); }
        .nav-dot.neutral { background: var(--text-secondary); }

        /* Main Content */
        .main-content {
            margin-left: var(--sidebar-width);
            padding: 2rem 3rem;
            max-width: 1400px;
        }

        /* Hero Section */
        .hero {
            display: grid;
            grid-template-columns: 200px 280px 1fr;
            gap: 2rem;
            align-items: center;
            margin-bottom: 3rem;
            padding-bottom: 2rem;
            border-bottom: 1px solid var(--border-color);
        }

        .hero-score {
            text-align: center;
        }

        .score-circle {
            width: 160px;
            height: 160px;
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative;
            margin: 0 auto;
        }

        .score-circle.good {
            background: conic-gradient(var(--accent-green) 0deg, var(--accent-green) calc(var(--score) * 3.6deg), var(--bg-tertiary) calc(var(--score) * 3.6deg));
        }
        .score-circle.warning {
            background: conic-gradient(var(--accent-yellow) 0deg, var(--accent-yellow) calc(var(--score) * 3.6deg), var(--bg-tertiary) calc(var(--score) * 3.6deg));
        }
        .score-circle.danger {
            background: conic-gradient(var(--accent-red) 0deg, var(--accent-red) calc(var(--score) * 3.6deg), var(--bg-tertiary) calc(var(--score) * 3.6deg));
        }

        .score-circle::before {
            content: '';
            position: absolute;
            width: 130px;
            height: 130px;
            background: var(--bg-primary);
            border-radius: 50%;
        }

        .score-value { position: relative; font-size: 2.5rem; font-weight: bold; z-index: 1; }
        .score-label { position: relative; color: var(--text-secondary); font-size: 0.8rem; z-index: 1; }

        .hero-trend {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-top: 0.5rem;
        }
        .hero-trend.down { color: var(--accent-red); }
        .hero-trend.up { color: var(--accent-green); }

        .hero-radar {
            height: 200px;
        }

        .hero-metrics {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
        }

        .metric-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 1rem;
        }

        .metric-card-value {
            font-size: 1.5rem;
            font-weight: bold;
        }

        .metric-card-label {
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin-top: 0.25rem;
        }

        .metric-card-value.good { color: var(--accent-green); }
        .metric-card-value.warning { color: var(--accent-yellow); }
        .metric-card-value.danger { color: var(--accent-red); }

        /* Section Styles */
        .section {
            margin: 2.5rem 0;
            scroll-margin-top: 1rem;
        }

        .section-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }

        .section-header h2 {
            font-size: 1.4rem;
            font-weight: 600;
        }

        .section-subtitle {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }

        /* Cards */
        .card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1rem;
        }

        .card h3 {
            font-size: 1rem;
            margin-bottom: 1rem;
            color: var(--text-primary);
        }

        .card.highlight-red { border-left: 4px solid var(--accent-red); }
        .card.highlight-yellow { border-left: 4px solid var(--accent-yellow); }
        .card.highlight-green { border-left: 4px solid var(--accent-green); }
        .card.highlight-blue { border-left: 4px solid var(--accent-blue); }

        /* Recommendations List */
        .recommendations-list {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .recommendation-category {
            font-size: 0.85rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .recommendation-item {
            padding: 0.75rem 0;
            border-bottom: 1px solid var(--border-color);
        }

        .recommendation-item:last-child { border-bottom: none; }

        .recommendation-item strong {
            display: block;
            margin-bottom: 0.25rem;
        }

        .recommendation-item > div {
            color: var(--text-secondary);
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .recommendation-item > div p {
            margin: 0.25rem 0;
        }

        .recommendation-item > div p:first-child {
            margin-top: 0;
        }

        /* Stats Grid */
        .stat-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
        }

        .stat-box {
            background: var(--bg-tertiary);
            padding: 1rem;
            border-radius: 8px;
            text-align: center;
        }

        .stat-box .value {
            font-size: 1.75rem;
            font-weight: bold;
        }

        .stat-box .label {
            color: var(--text-secondary);
            font-size: 0.75rem;
            margin-top: 0.25rem;
        }

        /* Tables */
        .table-container {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            overflow: hidden;
        }

        /* Simple-DataTables dark theme overrides */
        .datatable-wrapper {
            background: var(--bg-secondary);
            border-radius: 8px;
            overflow: hidden;
        }

        .datatable-top, .datatable-bottom {
            padding: 0.75rem 1rem;
            background: var(--bg-secondary);
        }

        .datatable-search input {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            color: var(--text-primary);
            padding: 0.5rem 0.75rem;
        }

        .datatable-search input::placeholder {
            color: var(--text-secondary);
        }

        .datatable-search input:focus {
            outline: none;
            border-color: var(--accent-blue);
        }

        .datatable-selector {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            color: var(--text-primary);
            padding: 0.25rem 0.5rem;
        }

        .datatable-info {
            color: var(--text-secondary);
            font-size: 0.85rem;
        }

        .datatable-pagination-list {
            display: flex;
            gap: 0.25rem;
        }

        .datatable-pagination-list-item-link {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            color: var(--text-primary);
            padding: 0.25rem 0.5rem;
            text-decoration: none;
        }

        .datatable-pagination-list-item-link:hover {
            background: var(--bg-primary);
        }

        .datatable-pagination-list-item.datatable-active .datatable-pagination-list-item-link {
            background: var(--accent-blue);
            border-color: var(--accent-blue);
        }

        .datatable-pagination-list-item.datatable-disabled .datatable-pagination-list-item-link {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Simple-DataTables header sorting */
        .datatable-table th {
            cursor: pointer;
            user-select: none;
        }

        .datatable-table th:hover {
            color: var(--text-primary);
        }

        .datatable-sorter {
            color: var(--text-secondary);
        }

        .datatable-sorter::before,
        .datatable-sorter::after {
            border-color: var(--text-secondary) transparent;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 0.75rem 1rem;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        th {
            background: var(--bg-tertiary);
            font-weight: 600;
            color: var(--text-secondary);
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.03em;
        }

        tr:hover td {
            background: var(--bg-tertiary);
        }

        /* Badges */
        .badge {
            display: inline-block;
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .badge.critical { background: #f8514933; color: var(--accent-red); }
        .badge.high { background: #d2992233; color: var(--accent-yellow); }
        .badge.medium { background: #58a6ff33; color: var(--accent-blue); }
        .badge.low { background: #3fb95033; color: var(--accent-green); }

        .files-badge {
            display: inline-block;
            padding: 0.15rem 0.4rem;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 500;
            background: var(--bg-tertiary);
            color: var(--accent-blue);
            cursor: help;
            border: 1px solid var(--border-color);
        }

        .files-badge:hover {
            background: var(--bg-secondary);
            border-color: var(--accent-blue);
        }

        /* Tooltips */
        .tooltip {
            cursor: help;
            border-bottom: 1px dotted var(--text-secondary);
        }

        /* Tippy.js dark theme */
        .tippy-box {
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            font-size: 0.8rem;
            font-weight: 400;
            line-height: 1.4;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .tippy-box[data-placement^='top'] > .tippy-arrow::before {
            border-top-color: var(--border-color);
        }

        .tippy-box[data-placement^='bottom'] > .tippy-arrow::before {
            border-bottom-color: var(--border-color);
        }

        .tippy-content {
            padding: 0.5rem 0.75rem;
            white-space: pre-wrap;
            max-width: 500px;
            word-break: break-all;
        }

        /* Narrative / Markdown Content */
        .narrative {
            color: var(--text-secondary);
            font-size: 0.95rem;
            line-height: 1.7;
        }

        .narrative p {
            margin: 0 0 1em 0;
        }

        .narrative p:last-child {
            margin-bottom: 0;
        }

        .narrative h1, .narrative h2, .narrative h3, .narrative h4 {
            color: var(--text-primary);
            margin: 1.5em 0 0.75em 0;
            font-weight: 600;
        }

        .narrative h1:first-child, .narrative h2:first-child, .narrative h3:first-child {
            margin-top: 0;
        }

        .narrative h1 { font-size: 1.4rem; }
        .narrative h2 { font-size: 1.2rem; }
        .narrative h3 { font-size: 1.05rem; }
        .narrative h4 { font-size: 0.95rem; }

        .narrative ul, .narrative ol {
            margin: 0.75em 0;
            padding-left: 1.5em;
        }

        .narrative li {
            margin: 0.35em 0;
        }

        .narrative li::marker {
            color: var(--accent-blue);
        }

        .narrative strong {
            color: var(--text-primary);
            font-weight: 600;
        }

        .narrative em {
            font-style: italic;
        }

        .narrative code {
            background: var(--bg-tertiary);
            padding: 0.15em 0.4em;
            border-radius: 4px;
            font-size: 0.9em;
            font-family: 'SF Mono', 'Menlo', 'Monaco', 'Courier New', monospace;
            color: var(--accent-blue);
        }

        .narrative pre {
            background: var(--bg-tertiary);
            padding: 1em;
            border-radius: 6px;
            overflow-x: auto;
            margin: 1em 0;
        }

        .narrative pre code {
            background: none;
            padding: 0;
            font-size: 0.85em;
            color: var(--text-primary);
        }

        .narrative blockquote {
            border-left: 3px solid var(--accent-blue);
            margin: 1em 0;
            padding: 0.5em 0 0.5em 1em;
            color: var(--text-secondary);
            background: var(--bg-tertiary);
            border-radius: 0 4px 4px 0;
        }

        .narrative blockquote p {
            margin: 0;
        }

        .narrative a {
            color: var(--accent-blue);
            text-decoration: none;
        }

        .narrative a:hover {
            text-decoration: underline;
        }

        .narrative hr {
            border: none;
            border-top: 1px solid var(--border-color);
            margin: 1.5em 0;
        }

        .narrative table {
            width: 100%;
            border-collapse: collapse;
            margin: 1em 0;
            font-size: 0.9em;
        }

        .narrative th, .narrative td {
            padding: 0.5em 0.75em;
            text-align: left;
            border: 1px solid var(--border-color);
        }

        .narrative th {
            background: var(--bg-tertiary);
            font-weight: 600;
            color: var(--text-primary);
        }

        /* Charts */
        .chart-container {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1rem 0;
        }

        .chart-container h3 {
            margin-bottom: 1rem;
            font-size: 1rem;
        }

        .chart-wrapper {
            position: relative;
            height: 350px;
        }

        /* Grid layouts */
        .grid-2 {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1.5rem;
        }

        .grid-3 {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
        }

        /* Collapsible */
        .collapsible {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            margin: 1rem 0;
        }

        .collapsible-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 1.5rem;
            cursor: pointer;
            user-select: none;
        }

        .collapsible-header:hover {
            background: var(--bg-tertiary);
            border-radius: 8px;
        }

        .collapsible-header h3 {
            margin: 0;
            font-size: 1rem;
        }

        .collapsible-toggle {
            color: var(--text-secondary);
            font-size: 1.2rem;
            transition: transform 0.2s;
        }

        .collapsible.open .collapsible-toggle {
            transform: rotate(180deg);
        }

        .collapsible-content {
            display: none;
            padding: 0 1.5rem 1.5rem;
        }

        .collapsible.open .collapsible-content {
            display: block;
        }

        /* Key Findings */
        .key-finding {
            padding: 0.75rem 0;
            border-bottom: 1px solid var(--border-color);
            color: var(--text-secondary);
        }

        .key-finding:last-child {
            border-bottom: none;
        }

        /* Progress bars */
        .progress-bar {
            height: 6px;
            background: var(--bg-tertiary);
            border-radius: 3px;
            overflow: hidden;
            margin-top: 0.5rem;
        }

        .progress-fill {
            height: 100%;
            border-radius: 3px;
        }

        .progress-fill.good { background: var(--accent-green); }
        .progress-fill.warning { background: var(--accent-yellow); }
        .progress-fill.danger { background: var(--accent-red); }

        /* Component score cards */
        .component-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 1rem;
        }

        .component-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .component-card-name {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .component-card-score {
            font-size: 1.25rem;
            font-weight: bold;
        }

        .component-card-weight {
            font-size: 0.7rem;
            color: var(--text-secondary);
        }

        /* Report Header */
        .report-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            padding-bottom: 1.5rem;
            margin-bottom: 2rem;
            border-bottom: 1px solid var(--border-color);
        }

        .report-title {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .report-title h1 {
            font-size: 1.75rem;
            font-weight: 600;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .report-title h1 code {
            font-weight: 500;
            color: var(--accent-blue);
            background: var(--bg-tertiary);
            padding: 0.1rem 0.4rem;
            border-radius: 4px;
            font-size: 1.5rem;
        }

        .report-meta {
            display: flex;
            gap: 1.5rem;
            color: var(--text-secondary);
            font-size: 0.85rem;
        }

        .report-meta-item {
            display: flex;
            align-items: center;
            gap: 0.35rem;
        }

        .report-branding a {
            color: var(--text-primary);
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .report-branding a:hover {
            color: var(--accent-blue);
        }

        .branding-text {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            line-height: 1.2;
            text-align: right;
        }

        .branding-name {
            font-weight: 600;
            font-size: 1rem;
        }

        .branding-version {
            color: var(--text-muted);
            font-size: 0.65rem;
            opacity: 0.7;
        }

        .omen-logo {
            width: 32px;
            height: 32px;
        }

        /* Footer */
        footer {
            text-align: center;
            padding: 2rem;
            border-top: 1px solid var(--border-color);
            margin-top: 3rem;
            color: var(--text-secondary);
        }

        footer a {
            color: var(--accent-blue);
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .hero {
                grid-template-columns: 180px 1fr;
            }
            .hero-radar {
                display: none;
            }
        }

        @media (max-width: 900px) {
            .sidebar {
                display: none;
            }
            .main-content {
                margin-left: 0;
                padding: 1.5rem;
            }
            .hero {
                grid-template-columns: 1fr;
                text-align: center;
            }
            .hero-metrics {
                grid-template-columns: repeat(2, 1fr);
            }
            .recommendations-grid {
                grid-template-columns: 1fr;
            }
            .grid-2, .grid-3 {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Sidebar Navigation -->
    <nav class="sidebar">
        <div class="sidebar-header">
            <h2>Health Score</h2>
            <div class="sidebar-score {{.ScoreClass}}">{{.Score.Score}}</div>
        </div>

        <div class="nav-section">
            <div class="nav-section-title">Overview</div>
            <a href="#summary" class="nav-item">
                <span class="nav-dot neutral"></span>
                Executive Summary
            </a>
            <a href="#recommendations" class="nav-item">
                <span class="nav-dot {{if .Summary}}{{if .Summary.Recommendations.HighPriority}}danger{{else}}good{{end}}{{else}}neutral{{end}}"></span>
                Recommendations
            </a>
            <a href="#findings" class="nav-item">
                <span class="nav-dot neutral"></span>
                Key Findings
            </a>
        </div>

        <div class="nav-section">
            <div class="nav-section-title">Risk Areas</div>
            {{if .Hotspots}}{{if .Hotspots.Files}}
            <a href="#hotspots" class="nav-item">
                <span class="nav-dot {{if gt (len .Hotspots.Files) 20}}danger{{else if gt (len .Hotspots.Files) 10}}warning{{else}}good{{end}}"></span>
                Hotspots
            </a>
            {{end}}{{end}}
            {{if .FlagsInsight}}
            <a href="#flags" class="nav-item">
                <span class="nav-dot warning"></span>
                Feature Flags
            </a>
            {{end}}
            {{if .Cohesion}}
            <a href="#cohesion" class="nav-item">
                <span class="nav-dot {{if lt (index .Score.Components "cohesion") 70}}danger{{else if lt (index .Score.Components "cohesion") 80}}warning{{else}}good{{end}}"></span>
                Low Cohesion
            </a>
            {{end}}
        </div>

        <div class="nav-section">
            <div class="nav-section-title">Technical Debt</div>
            {{if .SATD}}{{if .SATD.Items}}
            <a href="#satd" class="nav-item">
                <span class="nav-dot {{if gt (countSeverity .SATD.Items "critical") 5}}danger{{else if gt (countSeverity .SATD.Items "critical") 0}}warning{{else}}good{{end}}"></span>
                Known Issues
            </a>
            {{end}}{{end}}
            {{if .Duplicates}}
            <a href="#duplicates" class="nav-item">
                <span class="nav-dot {{if gt .Duplicates.DuplicationRatio 15.0}}danger{{else if gt .Duplicates.DuplicationRatio 10.0}}warning{{else}}good{{end}}"></span>
                Duplication
            </a>
            {{end}}
        </div>

        <div class="nav-section">
            <div class="nav-section-title">Analysis</div>
            {{if .Trend}}
            <a href="#trends" class="nav-item">
                <span class="nav-dot {{if lt .Trend.Slope -0.5}}danger{{else if lt .Trend.Slope 0.0}}warning{{else}}good{{end}}"></span>
                Trends
            </a>
            {{end}}
            {{if .Churn}}
            <a href="#churn" class="nav-item">
                <span class="nav-dot neutral"></span>
                Change Activity
            </a>
            {{end}}
            {{if .Ownership}}
            <a href="#ownership" class="nav-item">
                <span class="nav-dot {{if lt .Ownership.BusFactor 3}}danger{{else if lt .Ownership.BusFactor 5}}warning{{else}}good{{end}}"></span>
                Ownership
            </a>
            {{end}}
        </div>

        <div class="nav-section">
            <div class="nav-section-title">Reference</div>
            <a href="#breakdown" class="nav-item">
                <span class="nav-dot neutral"></span>
                Score Breakdown
            </a>
            <a href="#glossary" class="nav-item">
                <span class="nav-dot neutral"></span>
                Glossary
            </a>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Report Header -->
        <header class="report-header">
            <div class="report-title">
                <h1>Health Report: <code>{{.Metadata.Repository}}</code></h1>
                <div class="report-meta">
                    <span class="report-meta-item">
                        <svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor"><path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0ZM1.5 8a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0Zm7-3.25v2.992l2.028.812a.75.75 0 0 1-.557 1.392l-2.5-1A.751.751 0 0 1 7 8.25v-3.5a.75.75 0 0 1 1.5 0Z"></path></svg>
                        {{.Metadata.GeneratedAt.Format "Jan 2, 2006 3:04 PM"}}
                    </span>
                    {{if .Metadata.Since}}
                    <span class="report-meta-item">
                        <svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor"><path d="M5.75 0a.75.75 0 0 1 .75.75V2h3V.75a.75.75 0 0 1 1.5 0V2h1.25c.966 0 1.75.784 1.75 1.75v10.5A1.75 1.75 0 0 1 12.25 16H3.75A1.75 1.75 0 0 1 2 14.25V3.75C2 2.784 2.784 2 3.75 2H5V.75A.75.75 0 0 1 5.75 0Zm-2 5.5a.25.25 0 0 0-.25.25v8.5c0 .138.112.25.25.25h8.5a.25.25 0 0 0 .25-.25v-8.5a.25.25 0 0 0-.25-.25Z"></path></svg>
                        {{.Metadata.Since}} history
                    </span>
                    {{end}}
                </div>
            </div>
            <div class="report-branding">
                <a href="https://github.com/panbanda/omen" target="_blank">
                    <span class="branding-text">
                        <span class="branding-name">omen</span>
                        <span class="branding-version">{{.Metadata.OmenVersion}}</span>
                    </span>
                </a>
            </div>
        </header>

        <!-- Hero Section -->
        <section class="hero">
            <div class="hero-score">
                <div class="score-circle {{.ScoreClass}}" style="--score: {{.Score.Score}}">
                    <span class="score-value">{{.Score.Score}}</span>
                    <span class="score-label">Health Score</span>
                </div>
                {{if .Trend}}
                <div class="hero-trend {{if lt .Trend.Slope 0.0}}down{{else if gt .Trend.Slope 0.0}}up{{end}}">
                    {{if lt .Trend.Slope 0.0}}Declining{{else if gt .Trend.Slope 0.0}}Improving{{else}}Stable{{end}} ({{printf "%.2f" .Trend.Slope}}/mo)
                </div>
                {{end}}
            </div>

            <div class="hero-radar">
                <canvas id="radarChart"></canvas>
            </div>

            <div class="hero-metrics">
                <div class="metric-card">
                    <div class="metric-card-value">{{.Score.FilesAnalyzed}}</div>
                    <div class="metric-card-label">Files Analyzed</div>
                </div>
                {{if .Hotspots}}{{if .Hotspots.Files}}
                <div class="metric-card">
                    <div class="metric-card-value {{if gt (len .Hotspots.Files) 20}}danger{{else if gt (len .Hotspots.Files) 10}}warning{{else}}good{{end}}">{{len .Hotspots.Files}}</div>
                    <div class="metric-card-label">Hotspot Files</div>
                </div>
                {{end}}{{end}}
                {{if .SATD}}{{if .SATD.Items}}
                <div class="metric-card">
                    <div class="metric-card-value {{if gt (countSeverity .SATD.Items "critical") 5}}danger{{else if gt (countSeverity .SATD.Items "critical") 0}}warning{{else}}good{{end}}">{{countSeverity .SATD.Items "critical"}}</div>
                    <div class="metric-card-label">Critical Issues</div>
                </div>
                {{end}}{{end}}
                {{if .Duplicates}}
                <div class="metric-card">
                    <div class="metric-card-value {{if gt .Duplicates.DuplicationRatio 15.0}}danger{{else if gt .Duplicates.DuplicationRatio 10.0}}warning{{else}}good{{end}}">{{printf "%.1f" .Duplicates.DuplicationRatio}}%</div>
                    <div class="metric-card-label">Duplication</div>
                </div>
                {{end}}
            </div>
        </section>

        <!-- Executive Summary -->
        {{if .Summary}}
        {{if .Summary.ExecutiveSummary}}
        <section id="summary" class="section">
            <div class="section-header">
                <h2>Executive Summary</h2>
            </div>
            <div class="card">
                <div class="narrative">{{.Summary.ExecutiveSummary | markdown}}</div>
            </div>
        </section>
        {{end}}

        <!-- Recommendations -->
        {{if or .Summary.Recommendations.HighPriority .Summary.Recommendations.MediumPriority .Summary.Recommendations.Ongoing}}
        <section id="recommendations" class="section">
            <div class="section-header">
                <h2>Recommendations</h2>
            </div>
            <p class="section-subtitle">Prioritized actions to improve code health</p>

            <div class="recommendations-list">
                {{if .Summary.Recommendations.HighPriority}}
                <div class="card highlight-red">
                    <div class="recommendation-category" style="color: var(--accent-red);">
                        <span class="nav-dot danger"></span>
                        Critical - Address Soon
                    </div>
                    {{range .Summary.Recommendations.HighPriority}}
                    <div class="recommendation-item">
                        <strong>{{.Title}}</strong>
                        <div>{{.Description | markdown}}</div>
                    </div>
                    {{end}}
                </div>
                {{end}}

                {{if .Summary.Recommendations.MediumPriority}}
                <div class="card highlight-yellow">
                    <div class="recommendation-category" style="color: var(--accent-yellow);">
                        <span class="nav-dot warning"></span>
                        Important - Plan For
                    </div>
                    {{range .Summary.Recommendations.MediumPriority}}
                    <div class="recommendation-item">
                        <strong>{{.Title}}</strong>
                        <div>{{.Description | markdown}}</div>
                    </div>
                    {{end}}
                </div>
                {{end}}

                {{if .Summary.Recommendations.Ongoing}}
                <div class="card highlight-blue">
                    <div class="recommendation-category" style="color: var(--accent-blue);">
                        <span class="nav-dot neutral"></span>
                        Maintenance - Keep Doing
                    </div>
                    {{range .Summary.Recommendations.Ongoing}}
                    <div class="recommendation-item">
                        <strong>{{.Title}}</strong>
                        <div>{{.Description | markdown}}</div>
                    </div>
                    {{end}}
                </div>
                {{end}}
            </div>
        </section>
        {{end}}

        <!-- Key Findings -->
        {{if .Summary.KeyFindings}}
        <section id="findings" class="section">
            <div class="section-header">
                <h2>Key Findings</h2>
            </div>
            <div class="card">
                {{range .Summary.KeyFindings}}
                <div class="key-finding narrative">{{. | markdown}}</div>
                {{end}}
            </div>
        </section>
        {{end}}
        {{end}}

        <!-- Hotspots -->
        {{if .Hotspots}}
        {{if .Hotspots.Files}}
        <section id="hotspots" class="section">
            <div class="section-header">
                <h2>Hotspots</h2>
            </div>
            <p class="section-subtitle">Files with both high complexity and frequent changes - highest risk for bugs</p>

            {{if .HotspotsInsight}}
            <div class="card" style="margin-bottom: 1.5rem;">
                <div class="narrative">{{.HotspotsInsight.SectionInsight | markdown}}</div>
            </div>
            {{end}}

            <div class="stat-grid">
                <div class="stat-box">
                    <div class="value">{{len .Hotspots.Files}}</div>
                    <div class="label">Hotspot Files</div>
                </div>
                {{if .Hotspots.Summary}}
                <div class="stat-box">
                    <div class="value">{{printf "%.2f" .Hotspots.Summary.MaxScore}}</div>
                    <div class="label">Highest Risk</div>
                </div>
                <div class="stat-box">
                    <div class="value">{{printf "%.2f" .Hotspots.Summary.AvgScore}}</div>
                    <div class="label">Average Risk</div>
                </div>
                {{end}}
            </div>

            <div class="table-container">
                <table id="hotspots-table">
                    <thead>
                        <tr>
                            <th>File</th>
                            <th><span class="tooltip" data-tooltip="Combined score of churn frequency and code complexity. Higher risk = more likely to have bugs.">Risk</span></th>
                            <th><span class="tooltip" data-tooltip="Number of times this file was modified in the analysis period.">Changes</span></th>
                            <th><span class="tooltip" data-tooltip="Cyclomatic complexity - number of independent paths through the code.">Complexity</span></th>
                        </tr>
                    </thead>
                    <tbody>
                        {{range .Hotspots.Files}}
                        <tr>
                            <td><code>{{truncatePath (relPath .Path $.Metadata.Paths) 60}}</code></td>
                            <td><span class="badge {{hotspotBadge .HotspotScore}}">{{printf "%.3f" .HotspotScore}}</span></td>
                            <td>{{.Commits}}</td>
                            <td>{{printf "%.1f" .AvgCognitive}}</td>
                        </tr>
                        {{end}}
                    </tbody>
                </table>
            </div>
        </section>
        {{end}}
        {{end}}

        <!-- Feature Flags -->
        {{if .FlagsInsight}}
        <section id="flags" class="section">
            <div class="section-header">
                <h2>Feature Flags</h2>
            </div>
            <p class="section-subtitle">Stale feature flags that should be cleaned up</p>

            <div class="card" style="margin-bottom: 1.5rem;">
                <div class="narrative">{{.FlagsInsight.SectionInsight | markdown}}</div>
            </div>

            {{if .Flags}}{{if .Flags.Flags}}
            <div class="table-container">
                <table id="flags-table">
                    <thead>
                        <tr>
                            <th>Flag</th>
                            <th><span class="tooltip" data-tooltip="Cleanup priority based on age and staleness. Critical flags are old and unchanged - likely safe to remove.">Priority</span></th>
                            <th><span class="tooltip" data-tooltip="Time since the flag was first introduced to the codebase.">Age</span></th>
                            <th><span class="tooltip" data-tooltip="Number of files containing references to this flag. Higher spread = more cleanup effort.">Files</span></th>
                            <th>Provider</th>
                        </tr>
                    </thead>
                    <tbody>
                        {{range .Flags.Flags}}
                        <tr>
                            <td><code>{{.FlagKey}}</code></td>
                            <td><span class="badge {{.Priority.Level | priorityBadge}}">{{.Priority.Level}}</span></td>
                            <td><span class="time-ago" data-timestamp="{{.Staleness.IntroducedAt}}"></span></td>
                            <td><span class="files-badge tooltip" data-tooltip="{{flagFilesTooltip .References $.Metadata.Paths}}">{{.Complexity.FileSpread}} file{{if ne .Complexity.FileSpread 1}}s{{end}}</span></td>
                            <td>{{.Provider}}</td>
                        </tr>
                        {{end}}
                    </tbody>
                </table>
            </div>
            {{end}}{{end}}
        </section>
        {{end}}

        <!-- Low Cohesion Classes -->
        {{if .Cohesion}}
        {{if .Cohesion.Classes}}
        <section id="cohesion" class="section">
            <div class="section-header">
                <h2>Low Cohesion Classes</h2>
            </div>
            <p class="section-subtitle">Classes doing too many unrelated things - candidates for splitting</p>

            {{if .ComponentsInsight}}{{if index .ComponentsInsight.ComponentInsights "cohesion"}}
            <div class="card" style="margin-bottom: 1.5rem;">
                <div class="narrative">{{index .ComponentsInsight.ComponentInsights "cohesion" | markdown}}</div>
            </div>
            {{end}}{{end}}

            <div class="table-container">
                <table id="cohesion-table">
                    <thead>
                        <tr>
                            <th>Class</th>
                            <th><span class="tooltip" data-tooltip="Lack of Cohesion of Methods. Higher values indicate a class is doing too many unrelated things and should be split.">LCOM</span></th>
                            <th><span class="tooltip" data-tooltip="Weighted Methods per Class. Sum of complexity of all methods. High values indicate overly complex classes.">WMC</span></th>
                            <th><span class="tooltip" data-tooltip="Coupling Between Objects. Number of classes this class depends on. High coupling makes changes risky.">CBO</span></th>
                        </tr>
                    </thead>
                    <tbody>
                        {{range .Cohesion.Classes}}
                        <tr>
                            <td><code>{{.ClassName}}</code></td>
                            <td><span class="badge {{if gt .LCOM 50}}critical{{else if gt .LCOM 20}}high{{else}}medium{{end}}">{{.LCOM}}</span></td>
                            <td>{{.WMC}}</td>
                            <td>{{.CBO}}</td>
                        </tr>
                        {{end}}
                    </tbody>
                </table>
            </div>
        </section>
        {{end}}
        {{end}}

        <!-- SATD / Known Issues -->
        {{if .SATD}}
        {{if .SATD.Items}}
        <section id="satd" class="section">
            <div class="section-header">
                <h2>Known Issues</h2>
            </div>
            <p class="section-subtitle">Problems the team has documented but not yet fixed (TODO, FIXME, HACK)</p>

            {{if .SATDInsight}}
            <div class="card" style="margin-bottom: 1.5rem;">
                <div class="narrative">{{.SATDInsight.SectionInsight | markdown}}</div>
            </div>
            {{end}}

            <div class="stat-grid">
                <div class="stat-box">
                    <div class="value">{{len .SATD.Items}}</div>
                    <div class="label">Total Issues</div>
                </div>
                <div class="stat-box">
                    <div class="value" style="color: var(--accent-red)">{{countSeverity .SATD.Items "critical"}}</div>
                    <div class="label">Critical</div>
                </div>
                <div class="stat-box">
                    <div class="value" style="color: var(--accent-yellow)">{{countSeverity .SATD.Items "high"}}</div>
                    <div class="label">High</div>
                </div>
                <div class="stat-box">
                    <div class="value" style="color: var(--accent-blue)">{{countSeverity .SATD.Items "medium"}}</div>
                    <div class="label">Medium</div>
                </div>
            </div>

            <div class="grid-2">
                <div class="chart-container">
                    <h3>By Severity</h3>
                    <div class="chart-wrapper" style="height: 220px;">
                        <canvas id="satdSeverityChart"></canvas>
                    </div>
                </div>
                <div class="chart-container">
                    <h3>By Category</h3>
                    <div class="chart-wrapper" style="height: 220px;">
                        <canvas id="satdCategoryChart"></canvas>
                    </div>
                </div>
            </div>

            <div class="table-container">
                <table id="satd-table">
                    <thead>
                        <tr>
                            <th><span class="tooltip" data-tooltip="Impact level based on marker type. FIXME/XXX are critical, TODO is high, HACK/TEMP are medium.">Severity</span></th>
                            <th><span class="tooltip" data-tooltip="Type of technical debt: defect (bugs), design (architecture), requirement (missing features), etc.">Category</span></th>
                            <th>File</th>
                            <th>Line</th>
                        </tr>
                    </thead>
                    <tbody>
                        {{range .SATD.Items}}
                        <tr>
                            <td><span class="badge {{lower .Severity}}">{{.Severity}}</span></td>
                            <td>{{.Category}}</td>
                            <td><code>{{truncatePath (relPath .File $.Metadata.Paths) 50}}</code></td>
                            <td>{{.Line}}</td>
                        </tr>
                        {{end}}
                    </tbody>
                </table>
            </div>
        </section>
        {{end}}
        {{end}}

        <!-- Duplicates -->
        {{if .Duplicates}}
        <section id="duplicates" class="section">
            <div class="section-header">
                <h2>Duplicated Code</h2>
            </div>
            <p class="section-subtitle">Code that appears in multiple places - bugs fixed in one spot may need fixing elsewhere</p>

            {{if .DuplicationInsight}}
            <div class="card" style="margin-bottom: 1.5rem;">
                <div class="narrative">{{.DuplicationInsight.SectionInsight | markdown}}</div>
            </div>
            {{end}}

            <div class="stat-grid">
                <div class="stat-box">
                    <div class="value" style="color: {{if gt .Duplicates.DuplicationRatio 15.0}}var(--accent-red){{else if gt .Duplicates.DuplicationRatio 10.0}}var(--accent-yellow){{else}}var(--accent-green){{end}}">{{printf "%.1f" .Duplicates.DuplicationRatio}}%</div>
                    <div class="label">Duplication Rate</div>
                </div>
                <div class="stat-box">
                    <div class="value">{{.Duplicates.CloneGroups}}</div>
                    <div class="label">Clone Groups</div>
                </div>
                <div class="stat-box">
                    <div class="value">{{.Duplicates.DuplicateLines}}</div>
                    <div class="label">Duplicate Lines</div>
                </div>
                <div class="stat-box">
                    <div class="value">{{.Duplicates.TotalLines}}</div>
                    <div class="label">Total Lines</div>
                </div>
            </div>
        </section>
        {{end}}

        <!-- Trends -->
        {{if .Trend}}
        <section id="trends" class="section">
            <div class="section-header">
                <h2>Historical Trends</h2>
            </div>
            <p class="section-subtitle">How code quality has changed over time</p>

            {{if .TrendsInsight}}
            <div class="card" style="margin-bottom: 1.5rem;">
                <div class="narrative">{{.TrendsInsight.SectionInsight | markdown}}</div>
            </div>
            {{end}}

            <div class="stat-grid">
                <div class="stat-box">
                    <div class="value">{{.Trend.StartScore}}</div>
                    <div class="label">Starting Score</div>
                </div>
                <div class="stat-box">
                    <div class="value">{{.Trend.EndScore}}</div>
                    <div class="label">Current Score</div>
                </div>
                <div class="stat-box">
                    <div class="value" style="color: {{if lt .Trend.Slope 0.0}}var(--accent-yellow){{else}}var(--accent-green){{end}}">{{printf "%+.2f" .Trend.Slope}}</div>
                    <div class="label">Monthly Change</div>
                </div>
                <div class="stat-box">
                    <div class="value">{{printf "%.2f" .Trend.RSquared}}</div>
                    <div class="label">Trend Fit (R2)</div>
                </div>
            </div>

            <div class="chart-container">
                <h3>Health Score Over Time</h3>
                <div class="chart-wrapper">
                    <canvas id="trendsChart"></canvas>
                </div>
            </div>

            <div class="chart-container">
                <h3>Component Trends</h3>
                <div class="chart-wrapper">
                    <canvas id="componentTrendsChart"></canvas>
                </div>
            </div>

            {{if .TrendsInsight}}
            {{if .TrendsInsight.HistoricalEvents}}
            <div class="card">
                <h3>Notable Events</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Period</th>
                            <th>Change</th>
                            <th>Driver</th>
                        </tr>
                    </thead>
                    <tbody>
                        {{range .TrendsInsight.HistoricalEvents}}
                        <tr style="background: {{if lt .Change 0}}#f8514915{{else}}#3fb95015{{end}};">
                            <td><strong>{{.Period}}</strong></td>
                            <td><span class="badge {{if lt .Change -5}}critical{{else if lt .Change 0}}high{{else}}low{{end}}">{{if gt .Change 0}}+{{end}}{{.Change}} pts</span></td>
                            <td>{{.PrimaryDriver}}</td>
                        </tr>
                        {{end}}
                    </tbody>
                </table>
            </div>
            {{end}}
            {{end}}
        </section>
        {{end}}

        <!-- Change Activity / Churn -->
        {{if .Churn}}
        <section id="churn" class="section">
            <div class="section-header">
                <h2>Change Activity</h2>
            </div>
            <p class="section-subtitle">How frequently code is being modified</p>

            {{if .ChurnInsight}}
            <div class="card" style="margin-bottom: 1.5rem;">
                <div class="narrative">{{.ChurnInsight.SectionInsight | markdown}}</div>
            </div>
            {{end}}

            <div class="stat-grid">
                <div class="stat-box">
                    <div class="value">{{.Churn.Summary.TotalCommits}}</div>
                    <div class="label">Total Changes</div>
                </div>
                <div class="stat-box">
                    <div class="value">{{.Churn.Summary.UniqueFiles}}</div>
                    <div class="label">Files Changed</div>
                </div>
                <div class="stat-box">
                    <div class="value">{{.Churn.Summary.TotalAdded}}</div>
                    <div class="label">Lines Added</div>
                </div>
                <div class="stat-box">
                    <div class="value">{{.Churn.Summary.TotalDeleted}}</div>
                    <div class="label">Lines Deleted</div>
                </div>
            </div>

            {{if .Churn.Files}}
            <div class="table-container">
                <table id="churn-table">
                    <thead>
                        <tr>
                            <th>File</th>
                            <th><span class="tooltip" data-tooltip="Number of commits that modified this file in the analysis period.">Changes</span></th>
                            <th><span class="tooltip" data-tooltip="Number of unique authors who modified this file.">Contributors</span></th>
                            <th><span class="tooltip" data-tooltip="Normalized score combining commit frequency and lines changed. Higher = more volatile.">Churn Score</span></th>
                        </tr>
                    </thead>
                    <tbody>
                        {{range .Churn.Files}}
                        <tr>
                            <td><code>{{.File}}</code></td>
                            <td>{{.Commits}}</td>
                            <td>{{len .Authors}}</td>
                            <td><span class="badge {{churnBadge .ChurnScore}}">{{printf "%.3f" .ChurnScore}}</span></td>
                        </tr>
                        {{end}}
                    </tbody>
                </table>
            </div>
            {{end}}
        </section>
        {{end}}

        <!-- Ownership -->
        {{if .Ownership}}
        <section id="ownership" class="section">
            <div class="section-header">
                <h2>Code Ownership</h2>
            </div>
            <p class="section-subtitle">How knowledge is distributed - concentrated knowledge is a risk</p>

            {{if .OwnershipInsight}}
            <div class="card" style="margin-bottom: 1.5rem;">
                <div class="narrative">{{.OwnershipInsight.SectionInsight | markdown}}</div>
            </div>
            {{end}}

            <div class="stat-grid">
                <div class="stat-box">
                    <div class="value" style="color: {{if lt .Ownership.BusFactor 3}}var(--accent-red){{else if lt .Ownership.BusFactor 5}}var(--accent-yellow){{else}}var(--accent-green){{end}}">{{.Ownership.BusFactor}}</div>
                    <div class="label"><span class="tooltip" data-tooltip="Minimum people who would need to leave before critical knowledge is lost. Higher is better; 1 is a serious risk.">Bus Factor</span></div>
                </div>
                <div class="stat-box">
                    <div class="value" style="color: var(--accent-yellow)">{{.Ownership.KnowledgeSilos}}</div>
                    <div class="label"><span class="tooltip" data-tooltip="Files where one person has written most of the code. If they leave, knowledge is lost.">Knowledge Silos</span></div>
                </div>
                <div class="stat-box">
                    <div class="value">{{.Ownership.TotalFiles}}</div>
                    <div class="label">Total Files</div>
                </div>
                {{if gt .Ownership.TotalFiles 0}}
                <div class="stat-box">
                    <div class="value" style="color: var(--accent-yellow)">{{printf "%.1f" (percent .Ownership.KnowledgeSilos .Ownership.TotalFiles)}}%</div>
                    <div class="label">Files at Risk</div>
                </div>
                {{end}}
            </div>

            {{if .Ownership.TopOwners}}
            <div class="chart-container">
                <h3>Top Contributors</h3>
                <div class="chart-wrapper" style="height: 280px;">
                    <canvas id="ownershipChart"></canvas>
                </div>
            </div>
            {{end}}
        </section>
        {{end}}

        <!-- Score Breakdown -->
        <section id="breakdown" class="section">
            <div class="section-header">
                <h2>Score Breakdown</h2>
            </div>
            <p class="section-subtitle">How the health score is calculated from individual components</p>

            <div class="grid-3">
                {{if index .Score.Components "complexity"}}
                <div class="component-card">
                    <div class="component-card-header">
                        <span class="component-card-name">Complexity</span>
                        <span class="component-card-weight">25%</span>
                    </div>
                    <div class="component-card-score {{scoreClass (index .Score.Components "complexity")}}">{{index .Score.Components "complexity"}}</div>
                    <div class="progress-bar"><div class="progress-fill {{scoreClass (index .Score.Components "complexity")}}" style="width: {{index .Score.Components "complexity"}}%"></div></div>
                </div>
                {{end}}

                {{if index .Score.Components "duplication"}}
                <div class="component-card">
                    <div class="component-card-header">
                        <span class="component-card-name">Duplication</span>
                        <span class="component-card-weight">20%</span>
                    </div>
                    <div class="component-card-score {{scoreClass (index .Score.Components "duplication")}}">{{index .Score.Components "duplication"}}</div>
                    <div class="progress-bar"><div class="progress-fill {{scoreClass (index .Score.Components "duplication")}}" style="width: {{index .Score.Components "duplication"}}%"></div></div>
                </div>
                {{end}}

                {{if index .Score.Components "cohesion"}}
                <div class="component-card">
                    <div class="component-card-header">
                        <span class="component-card-name">Cohesion</span>
                        <span class="component-card-weight">15%</span>
                    </div>
                    <div class="component-card-score {{scoreClass (index .Score.Components "cohesion")}}">{{index .Score.Components "cohesion"}}</div>
                    <div class="progress-bar"><div class="progress-fill {{scoreClass (index .Score.Components "cohesion")}}" style="width: {{index .Score.Components "cohesion"}}%"></div></div>
                </div>
                {{end}}

                {{if index .Score.Components "tdg"}}
                <div class="component-card">
                    <div class="component-card-header">
                        <span class="component-card-name">Debt Gradient</span>
                        <span class="component-card-weight">15%</span>
                    </div>
                    <div class="component-card-score {{scoreClass (index .Score.Components "tdg")}}">{{index .Score.Components "tdg"}}</div>
                    <div class="progress-bar"><div class="progress-fill {{scoreClass (index .Score.Components "tdg")}}" style="width: {{index .Score.Components "tdg"}}%"></div></div>
                </div>
                {{end}}

                {{if index .Score.Components "satd"}}
                <div class="component-card">
                    <div class="component-card-header">
                        <span class="component-card-name">Known Debt</span>
                        <span class="component-card-weight">10%</span>
                    </div>
                    <div class="component-card-score {{scoreClass (index .Score.Components "satd")}}">{{index .Score.Components "satd"}}</div>
                    <div class="progress-bar"><div class="progress-fill {{scoreClass (index .Score.Components "satd")}}" style="width: {{index .Score.Components "satd"}}%"></div></div>
                </div>
                {{end}}

                {{if index .Score.Components "coupling"}}
                <div class="component-card">
                    <div class="component-card-header">
                        <span class="component-card-name">Coupling</span>
                        <span class="component-card-weight">10%</span>
                    </div>
                    <div class="component-card-score {{scoreClass (index .Score.Components "coupling")}}">{{index .Score.Components "coupling"}}</div>
                    <div class="progress-bar"><div class="progress-fill {{scoreClass (index .Score.Components "coupling")}}" style="width: {{index .Score.Components "coupling"}}%"></div></div>
                </div>
                {{end}}

                {{if index .Score.Components "smells"}}
                <div class="component-card">
                    <div class="component-card-header">
                        <span class="component-card-name">Code Smells</span>
                        <span class="component-card-weight">5%</span>
                    </div>
                    <div class="component-card-score {{scoreClass (index .Score.Components "smells")}}">{{index .Score.Components "smells"}}</div>
                    <div class="progress-bar"><div class="progress-fill {{scoreClass (index .Score.Components "smells")}}" style="width: {{index .Score.Components "smells"}}%"></div></div>
                </div>
                {{end}}
            </div>
        </section>

        <!-- Glossary -->
        <section id="glossary" class="section">
            <div class="collapsible" id="glossary-collapse">
                <div class="collapsible-header" onclick="toggleCollapsible('glossary-collapse')">
                    <h3>Glossary of Terms</h3>
                    <span class="collapsible-toggle">&#9660;</span>
                </div>
                <div class="collapsible-content">
                    <div class="grid-2">
                        <div class="card">
                            <h3>Health Score</h3>
                            <p style="color: var(--text-secondary);">A weighted composite metric (0-100) measuring overall code quality. Above 80 is good, 60-80 needs attention, below 60 is concerning.</p>
                        </div>
                        <div class="card">
                            <h3>Hotspot</h3>
                            <p style="color: var(--text-secondary);">A file that is both complex AND frequently changed. These are the highest-risk areas because they're hard to change safely but get changed often.</p>
                        </div>
                        <div class="card">
                            <h3>Bus Factor</h3>
                            <p style="color: var(--text-secondary);">The minimum number of people who would need to leave before critical knowledge is lost. Higher is better; 1 is a serious risk.</p>
                        </div>
                        <div class="card">
                            <h3>Knowledge Silo</h3>
                            <p style="color: var(--text-secondary);">A file that only one person has ever touched. If that person leaves, the knowledge goes with them.</p>
                        </div>
                        <div class="card">
                            <h3>Cyclomatic Complexity</h3>
                            <p style="color: var(--text-secondary);">The number of independent paths through code. More paths means more test cases needed and more ways things can go wrong.</p>
                        </div>
                        <div class="card">
                            <h3>Cognitive Complexity</h3>
                            <p style="color: var(--text-secondary);">How hard code is to understand. Accounts for nesting, breaks in flow, and things that make humans struggle to follow the logic.</p>
                        </div>
                        <div class="card">
                            <h3>LCOM (Cohesion)</h3>
                            <p style="color: var(--text-secondary);">How well a class's methods work together. High LCOM means methods don't share data - the class is probably doing too many unrelated things.</p>
                        </div>
                        <div class="card">
                            <h3>CBO (Coupling)</h3>
                            <p style="color: var(--text-secondary);">How many other classes a class depends on. High coupling means changes ripple through the codebase - everything is connected to everything.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <footer>
            <p>Generated {{.Metadata.GeneratedAt.Format "January 2, 2006"}} using <a href="https://github.com/panbanda/omen">Omen</a></p>
        </footer>
    </main>

    <script>
        // Toggle collapsible sections
        function toggleCollapsible(id) {
            const el = document.getElementById(id);
            el.classList.toggle('open');
        }

        // Highlight active nav item on scroll
        const sections = document.querySelectorAll('.section[id]');
        const navItems = document.querySelectorAll('.nav-item');

        window.addEventListener('scroll', () => {
            let current = '';
            sections.forEach(section => {
                const sectionTop = section.offsetTop;
                if (window.scrollY >= sectionTop - 100) {
                    current = section.getAttribute('id');
                }
            });

            navItems.forEach(item => {
                item.classList.remove('active');
                if (item.getAttribute('href') === '#' + current) {
                    item.classList.add('active');
                }
            });
        });

        // Format large numbers with commas
        document.querySelectorAll('.stat-box .value, .metric-card-value').forEach(el => {
            const text = el.textContent.trim();
            if (/^\d+$/.test(text)) {
                el.textContent = parseInt(text, 10).toLocaleString();
            }
        });

        // Render time-ago for timestamps using date-fns
        document.querySelectorAll('.time-ago').forEach(el => {
            const timestamp = el.dataset.timestamp;
            if (!timestamp) {
                el.textContent = '-';
                return;
            }
            const date = new Date(timestamp);
            if (isNaN(date.getTime())) {
                el.textContent = '-';
                return;
            }
            el.textContent = dateFns.formatDistanceToNow(date, { addSuffix: false });
            el.title = dateFns.format(date, 'MMM d, yyyy');
        });

        // Initialize Simple-DataTables on all data tables
        const dataTableConfig = {
            perPage: 15,
            perPageSelect: [10, 15, 25, 50, 100],
            searchable: true,
            sortable: true,
            labels: {
                placeholder: "Search...",
                perPage: "entries per page",
                noRows: "No entries found",
                info: "Showing {start} to {end} of {rows} entries"
            }
        };

        const tableIds = ['hotspots-table', 'flags-table', 'cohesion-table', 'satd-table', 'churn-table'];
        tableIds.forEach(id => {
            const table = document.getElementById(id);
            if (table && table.querySelector('tbody tr')) {
                new simpleDatatables.DataTable(table, dataTableConfig);
            }
        });

        // Initialize tooltips with Tippy.js (after DataTables to catch cloned elements)
        tippy('.tooltip', {
            content: (el) => el.getAttribute('data-tooltip'),
            placement: 'bottom',
            arrow: true,
            maxWidth: 300,
            appendTo: document.body
        });
    </script>

    <!-- Radar Chart -->
    <script>
        Chart.defaults.color = '#8b949e';
        Chart.defaults.borderColor = '#30363d';

        const radarCtx = document.getElementById('radarChart');
        if (radarCtx) {
            new Chart(radarCtx, {
                type: 'radar',
                data: {
                    labels: ['Complexity', 'Duplication', 'Cohesion', 'Coupling', 'Debt', 'Smells'],
                    datasets: [{
                        label: 'Score',
                        data: [
                            {{if index .Score.Components "complexity"}}{{index .Score.Components "complexity"}}{{else}}0{{end}},
                            {{if index .Score.Components "duplication"}}{{index .Score.Components "duplication"}}{{else}}0{{end}},
                            {{if index .Score.Components "cohesion"}}{{index .Score.Components "cohesion"}}{{else}}0{{end}},
                            {{if index .Score.Components "coupling"}}{{index .Score.Components "coupling"}}{{else}}0{{end}},
                            {{if index .Score.Components "satd"}}{{index .Score.Components "satd"}}{{else}}0{{end}},
                            {{if index .Score.Components "smells"}}{{index .Score.Components "smells"}}{{else}}0{{end}}
                        ],
                        backgroundColor: '#58a6ff33',
                        borderColor: '#58a6ff',
                        borderWidth: 2,
                        pointBackgroundColor: '#58a6ff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 100,
                            ticks: { stepSize: 20, display: false },
                            grid: { color: '#30363d' },
                            angleLines: { color: '#30363d' },
                            pointLabels: { font: { size: 10 } }
                        }
                    },
                    plugins: {
                        legend: { display: false }
                    }
                }
            });
        }
    </script>

    {{if .Trend}}
    <script>
        const trendsDataRaw = {
            labels: [{{range $i, $p := .Trend.Points}}{{if $i}}, {{end}}'{{$p.Date}}'{{end}}],
            scores: [{{range $i, $p := .Trend.Points}}{{if $i}}, {{end}}{{$p.Score}}{{end}}]
        };

        function formatDateLabel(isoDate) {
            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            const parts = isoDate.substring(0, 10).split('-');
            return months[parseInt(parts[1], 10) - 1] + ' ' + parts[0];
        }

        const trendsData = {
            labels: trendsDataRaw.labels.map(formatDateLabel),
            rawLabels: trendsDataRaw.labels,
            scores: trendsDataRaw.scores
        };

        {{if .TrendsInsight}}
        {{if .TrendsInsight.ScoreAnnotations}}
        const scoreAnnotations = {{.TrendsInsight.ScoreAnnotations | json}};
        {{else}}
        const scoreAnnotations = [];
        {{end}}
        {{else}}
        const scoreAnnotations = [];
        {{end}}

        {{if .ComponentsInsight}}
        {{if .ComponentsInsight.ComponentAnnotations}}
        const componentAnnotations = {{.ComponentsInsight.ComponentAnnotations | json}};
        {{else}}
        const componentAnnotations = {};
        {{end}}
        {{else}}
        const componentAnnotations = {};
        {{end}}

        function findLabelIndex(rawLabels, datePrefix) {
            return rawLabels.findIndex(label => label.startsWith(datePrefix));
        }

        const healthAnnotations = {};
        scoreAnnotations.forEach((ann, i) => {
            const labelIndex = findLabelIndex(trendsData.rawLabels, ann.date);
            if (labelIndex !== -1) {
                const xLabel = trendsData.labels[labelIndex];
                healthAnnotations['line' + i] = {
                    type: 'line',
                    xMin: xLabel,
                    xMax: xLabel,
                    borderColor: ann.change < 0 ? '#f8514988' : '#3fb95088',
                    borderWidth: 2,
                    borderDash: [6, 6]
                };
                healthAnnotations['label' + i] = {
                    type: 'label',
                    xValue: xLabel,
                    yValue: trendsData.scores[labelIndex] + (i % 2 === 0 ? 3 : -3),
                    backgroundColor: ann.change < 0 ? '#f8514933' : '#3fb95033',
                    borderColor: ann.change < 0 ? '#f85149' : '#3fb950',
                    borderWidth: 1,
                    borderRadius: 4,
                    color: '#e6edf3',
                    font: { size: 10 },
                    padding: 4,
                    content: ann.label
                };
            }
        });

        new Chart(document.getElementById('trendsChart'), {
            type: 'line',
            data: {
                labels: trendsData.labels,
                datasets: [{
                    label: 'Health Score',
                    data: trendsData.scores,
                    borderColor: '#58a6ff',
                    backgroundColor: '#58a6ff33',
                    fill: true,
                    tension: 0.3,
                    pointRadius: 4,
                    pointHoverRadius: 6
                }, {
                    label: 'Trend Line',
                    data: trendsData.labels.map((_, i) => {{.Trend.Intercept}} + ({{.Trend.Slope}} * i)),
                    borderColor: '#d2992288',
                    borderDash: [5, 5],
                    pointRadius: 0,
                    fill: false
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { position: 'top' },
                    tooltip: {
                        mode: 'index',
                        intersect: false,
                        callbacks: {
                            afterBody: function(context) {
                                const rawDate = trendsData.rawLabels[context[0].dataIndex];
                                const datePrefix = rawDate.substring(0, 7);
                                const ann = scoreAnnotations.find(a => a.date === datePrefix);
                                if (ann) {
                                    const maxWidth = 60;
                                    const words = ann.description.split(' ');
                                    const lines = [ann.label + ':'];
                                    let currentLine = '';

                                    words.forEach(word => {
                                        const testLine = currentLine ? currentLine + ' ' + word : word;
                                        if (testLine.length > maxWidth) {
                                            if (currentLine) lines.push(currentLine);
                                            currentLine = word;
                                        } else {
                                            currentLine = testLine;
                                        }
                                    });
                                    if (currentLine) lines.push(currentLine);

                                    return '\n' + lines.join('\n');
                                }
                                return '';
                            }
                        }
                    },
                    annotation: {
                        annotations: healthAnnotations
                    }
                },
                scales: {
                    x: {
                        ticks: {
                            maxRotation: 45,
                            minRotation: 45,
                            autoSkip: true,
                            maxTicksLimit: 15
                        }
                    },
                    y: {
                        min: Math.min(...trendsData.scores) - 5,
                        max: Math.max(...trendsData.scores) + 5,
                        title: { display: true, text: 'Score' }
                    }
                }
            }
        });

        {{if .Trend.ComponentTrends}}
        const componentLabelsRaw = [{{range $i, $p := .Trend.Points}}{{if $i}}, {{end}}'{{$p.Date}}'{{end}}];
        const componentLabels = componentLabelsRaw.map(formatDateLabel);

        const componentColors = {
            'complexity': '#3fb950',
            'duplication': '#58a6ff',
            'coupling': '#d29922',
            'cohesion': '#a371f7',
            'smells': '#f85149'
        };

        const componentChartAnnotations = {};
        Object.keys(componentAnnotations).forEach(componentName => {
            const events = componentAnnotations[componentName];
            const color = componentColors[componentName] || '#8b949e';
            events.forEach((ann, i) => {
                const key = componentName + '_' + i;
                const labelIndex = findLabelIndex(componentLabelsRaw, ann.date);
                if (labelIndex !== -1) {
                    const xLabel = componentLabels[labelIndex];
                    componentChartAnnotations['line_' + key] = {
                        type: 'line',
                        xMin: xLabel,
                        xMax: xLabel,
                        borderColor: color + '88',
                        borderWidth: 2,
                        borderDash: [6, 6]
                    };
                    componentChartAnnotations['label_' + key] = {
                        type: 'label',
                        xValue: xLabel,
                        yValue: 95 - (Object.keys(componentAnnotations).indexOf(componentName) * 2),
                        backgroundColor: color + '33',
                        borderColor: color,
                        borderWidth: 1,
                        borderRadius: 4,
                        color: '#e6edf3',
                        font: { size: 10 },
                        padding: 4,
                        content: ann.label
                    };
                }
            });
        });

        new Chart(document.getElementById('componentTrendsChart'), {
            type: 'line',
            data: {
                labels: componentLabels,
                datasets: [
                    {{range $i, $p := .Trend.Points}}{{if eq $i 0}}
                    { label: 'Complexity', data: [{{range $j, $pt := $.Trend.Points}}{{if $j}}, {{end}}{{index $pt.Components "complexity"}}{{end}}], borderColor: '#3fb950', tension: 0.3, pointRadius: 2 },
                    { label: 'Duplication', data: [{{range $j, $pt := $.Trend.Points}}{{if $j}}, {{end}}{{index $pt.Components "duplication"}}{{end}}], borderColor: '#58a6ff', tension: 0.3, pointRadius: 2 },
                    { label: 'Coupling', data: [{{range $j, $pt := $.Trend.Points}}{{if $j}}, {{end}}{{index $pt.Components "coupling"}}{{end}}], borderColor: '#d29922', tension: 0.3, pointRadius: 2 },
                    { label: 'Cohesion', data: [{{range $j, $pt := $.Trend.Points}}{{if $j}}, {{end}}{{index $pt.Components "cohesion"}}{{end}}], borderColor: '#a371f7', tension: 0.3, pointRadius: 2 },
                    { label: 'Smells', data: [{{range $j, $pt := $.Trend.Points}}{{if $j}}, {{end}}{{index $pt.Components "smells"}}{{end}}], borderColor: '#f85149', tension: 0.3, pointRadius: 2 }
                    {{end}}{{end}}
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { position: 'top' },
                    tooltip: {
                        mode: 'index',
                        intersect: false,
                        callbacks: {
                            afterBody: function(context) {
                                const rawDate = componentLabelsRaw[context[0].dataIndex];
                                const datePrefix = rawDate.substring(0, 7);
                                const results = [];
                                Object.keys(componentAnnotations).forEach(componentName => {
                                    const events = componentAnnotations[componentName];
                                    const event = events.find(e => e.date === datePrefix);
                                    if (event) {
                                        results.push('\n' + componentName.toUpperCase() + ': ' + event.label);
                                        results.push(event.description);
                                    }
                                });
                                return results.length > 0 ? '\n' + results.join('\n') : '';
                            }
                        }
                    },
                    annotation: {
                        annotations: componentChartAnnotations
                    }
                },
                scales: {
                    x: {
                        ticks: {
                            maxRotation: 45,
                            minRotation: 45,
                            autoSkip: true,
                            maxTicksLimit: 15
                        }
                    },
                    y: { min: 50, max: 100, title: { display: true, text: 'Score' } }
                }
            }
        });
        {{end}}
    </script>
    {{end}}

    {{if .Ownership}}
    {{if .Ownership.TopOwners}}
    <script>
        new Chart(document.getElementById('ownershipChart'), {
            type: 'bar',
            data: {
                labels: [{{range $i, $o := .Ownership.TopOwners}}{{if $i}}, {{end}}'{{$o.Name}}'{{end}}],
                datasets: [{
                    label: 'Files Owned',
                    data: [{{range $i, $o := .Ownership.TopOwners}}{{if $i}}, {{end}}{{$o.FilesOwned}}{{end}}],
                    backgroundColor: ['#58a6ff', '#3fb950', '#d29922', '#a371f7', '#f85149', '#8b949e', '#58a6ff', '#3fb950', '#d29922', '#a371f7']
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                indexAxis: 'y',
                plugins: { legend: { display: false } }
            }
        });
    </script>
    {{end}}
    {{end}}

    {{if .SATD}}
    {{if .SATD.Items}}
    <script>
        const satdItems = {{.SATDStats | json}};

        new Chart(document.getElementById('satdSeverityChart'), {
            type: 'doughnut',
            data: {
                labels: ['Critical', 'High', 'Medium', 'Low'],
                datasets: [{
                    data: [satdItems.critical, satdItems.high, satdItems.medium, satdItems.low],
                    backgroundColor: ['#f85149', '#d29922', '#58a6ff', '#3fb950']
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { position: 'right' } }
            }
        });

        new Chart(document.getElementById('satdCategoryChart'), {
            type: 'doughnut',
            data: {
                labels: Object.keys(satdItems.categories),
                datasets: [{
                    data: Object.values(satdItems.categories),
                    backgroundColor: ['#58a6ff', '#3fb950', '#a371f7', '#d29922', '#f85149', '#8b949e']
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { position: 'right' } }
            }
        });
    </script>
    {{end}}
    {{end}}
</body>
</html>
