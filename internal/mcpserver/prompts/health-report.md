---
name: health-report
title: Health Report
description: Generate an interactive HTML repository health report with visualizations. Use for stakeholder presentations, quarterly reviews, or comprehensive codebase health dashboards.
arguments:
  - name: paths
    description: Paths to analyze
    required: false
    default: "."
  - name: days
    description: Days of git history for churn analysis
    required: false
    default: "30"
  - name: trend_period
    description: "Trend analysis period: daily, weekly, monthly"
    required: false
    default: "monthly"
  - name: trend_since
    description: "How far back for trend analysis: 3m, 6m, 1y, 2y, 10y"
    required: false
    default: "1y"
---

# Repository Health Report

Generate an interactive HTML repository health report for: {{.paths}}

## When to Use

- Stakeholder presentations on code quality
- Quarterly engineering reviews
- Comprehensive codebase health dashboards
- Before major releases to assess technical debt
- New team member onboarding to understand codebase state

## Workflow

### Step 1: Repository Score
```
score_repository:
  paths: {{.paths}}
```
Get overall health score (0-100) and component breakdown.

### Step 2: Complexity Analysis
```
analyze_complexity:
  paths: {{.paths}}
```
Function-level cyclomatic and cognitive complexity metrics.

### Step 3: Hotspot Analysis
```
analyze_hotspot:
  paths: {{.paths}}
  days: {{.days}}
```
Files with high churn combined with high complexity.

### Step 4: Churn Analysis
```
analyze_churn:
  paths: {{.paths}}
  days: {{.days}}
```
Recent file change patterns and contributor activity.

### Step 5: Ownership Analysis
```
analyze_ownership:
  paths: {{.paths}}
```
Bus factor and knowledge silo identification.

### Step 6: SATD Analysis
```
analyze_satd:
  paths: {{.paths}}
```
Self-admitted technical debt (TODO/FIXME/HACK markers).

### Step 7: Duplication Analysis
```
analyze_duplicates:
  paths: {{.paths}}
```
Code clone detection and duplication ratio.

### Step 8: Feature Flags Analysis
```
analyze_flags:
  paths: {{.paths}}
```
Feature flag detection and staleness analysis.

### Step 9: Architectural Smells
```
analyze_smells:
  paths: {{.paths}}
```
Cyclic dependencies, god components, and coupling issues.

### Step 10: Cohesion Analysis
```
analyze_cohesion:
  paths: {{.paths}}
```
LCOM metrics for class/struct cohesion.

### Step 11: Trend Analysis
```
analyze_trend:
  paths: {{.paths}}
  since: {{.trend_since}}
  period: {{.trend_period}}
```
Historical score trends over time.

## Output

### Repository Health Report

**Scope**: {{.paths}}
**Generated by**: [Omen](https://github.com/panbanda/omen)
**Overall Score**: [0-100]
**Status**: [Healthy | Needs Attention | Critical]

---

### Executive Summary

| Metric | Score | Status |
|--------|-------|--------|
| Overall Health | | |
| Complexity | | |
| Duplication | | |
| Technical Debt | | |
| Coupling | | |
| Cohesion | | |

**Key Findings**:
1. [Most critical issue]
2. [Second priority]
3. [Third priority]

---

### Component Scores

For each component (Complexity, Duplication, Cohesion, TDG, SATD, Coupling, Smells):

| Component | Score | Status | Key Metric |
|-----------|-------|--------|------------|
| Complexity | | | % functions over threshold |
| Duplication | | | Duplication ratio |
| SATD | | | Items per KLOC |
| TDG | | | Average debt gradient |
| Coupling | | | Cyclic dependency count |
| Smells | | | Architectural issues |
| Cohesion | | | Average LCOM |

Score interpretation:
- Green (>80): Healthy
- Yellow (60-80): Needs attention
- Red (<60): Critical

---

### Hotspots

Files with high churn AND high complexity - prioritize these for refactoring:

| File | Hotspot Score | Commits | Complexity | Risk |
|------|---------------|---------|------------|------|
| | | | | HIGH/MED/LOW |

**Total Hotspots**: [count]
**Average Score**: [score]

---

### Code Churn

| Metric | Value |
|--------|-------|
| Total file changes | |
| Unique files changed | |
| Lines added | |
| Lines deleted | |

**Highest Churn Files**:
| File | Commits | Added | Deleted | Authors |
|------|---------|-------|---------|---------|
| | | | | |

**Top Contributors** (by commit volume):
| Author | Commits | Files Touched |
|--------|---------|---------------|
| | | |

---

### Ownership

| Metric | Value |
|--------|-------|
| Bus Factor | |
| Knowledge Silos | |
| Avg Contributors/File | |

**Knowledge Silos** (single-owner files in critical paths):
| File | Owner | Ownership % |
|------|-------|-------------|
| | | |

---

### Technical Debt (SATD)

| Severity | Count |
|----------|-------|
| Critical | |
| High | |
| Medium | |
| Low | |

**Critical Items** (must address):
| File | Line | Marker | Content |
|------|------|--------|---------|
| | | | |

---

### Duplication

| Metric | Value |
|--------|-------|
| Duplication Ratio | % |
| Clone Groups | |
| Lines Duplicated | |

**Largest Clone Groups**:
| Size (lines) | Occurrences | Files |
|--------------|-------------|-------|
| | | |

---

### Feature Flags

| Metric | Count |
|--------|-------|
| Total Flags | |
| Total References | |
| Stale Flags (>14 days) | |

**By Priority**:
| Priority | Count |
|----------|-------|
| Critical | |
| High | |
| Medium | |
| Low | |

**High-Priority Flags** (cleanup candidates):
| Flag Key | Provider | Age (days) | File Spread | Priority |
|----------|----------|------------|-------------|----------|
| | | | | |

---

### Architectural Issues

| Issue Type | Count | Severity |
|------------|-------|----------|
| Cyclic Dependencies | | Critical |
| God Components | | High |
| Hub Components | | High |
| Unstable Dependencies | | Medium |

---

### Recommendations

#### High Priority (This Sprint)
Issues needing immediate attention:
1. [Critical hotspots to refactor]
2. [Cyclic dependencies to break]
3. [Critical SATD to address]

#### Medium Priority (Next 2-4 Sprints)
Issues to address soon:
1. [High-complexity functions]
2. [Stale feature flags to remove]
3. [Knowledge silos to document]

#### Ongoing Maintenance
Metrics to monitor:
1. [Duplication ratio trend]
2. [Complexity threshold violations]
3. [Bus factor for critical files]

---

### Glossary

| Term | Definition |
|------|------------|
| Hotspot | File with both high churn and high complexity |
| Bus Factor | Minimum contributors whose departure would halt development |
| SATD | Self-Admitted Technical Debt (TODO/FIXME/HACK markers) |
| LCOM | Lack of Cohesion of Methods - measures class focus |
| TDG | Technical Debt Gradient - comprehensive debt score |

---

## HTML Report Generation

After gathering all data, generate a self-contained HTML file with:

### Visual Requirements
- Dark theme with GitHub-inspired colors
- Background: #0d1117, #161b22, #21262d
- Text: #e6edf3, #8b949e
- Accents: #3fb950 (green), #d29922 (yellow), #f85149 (red), #58a6ff (blue)

### Charts (Chart.js from CDN)
- Circular gauge for overall score
- Progress bars for component scores
- Doughnut charts for distributions
- Bar charts for comparisons

### File Output
Save as `repository-health-report.html` - self-contained with embedded CSS/JS.
